<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desmos Side By Side</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="static/styles.css">
    <meta name="seb-bek" content="dce5126358f122e9abaacc26c80cdcb34673703462ec2b59d90b04c9c8ec65c4">
    <meta name="seb-ck" content="9cb3543e7f84c76e2d566ae8b2119d086ea39a560972818ce0f82a953e21c6bb">
    <meta name="seb-ua" content="2bd0c026bb8ff538dd2c409f2b7af2d8dc741cb170213e264f0c0030dcd4a3b4">
    <script src="static/sebLock.js"></script>
</head>
<body>
    <header class="fixed-top-header">
        <div id="header-content" class="alert alert-danger mb-0 d-none">YIKES</div>
    </header>
    <button class="reset-button btn btn-primary" onclick="resetView()">Reset View</button>
    
    <div class="help-icon">?</div>
    <div class="help-tooltip">
        <h3>ðŸ“– Instructions</h3>
        <ul>
            <li><strong>Move:</strong> Click and drag the header bar</li>
            <li><strong>Resize:</strong> Drag from any edge or corner</li>
            <li><strong>Maximize:</strong> Double-click the header bar. Double-click again to restore.</li>
            <li><strong>Bring to Front:</strong> Click on the header bar</li>
            <li><strong>Reset View:</strong> Click the "Reset View" button</li>
        </ul>
        <p style="margin-top: 10px; font-style: italic; color: #666;">
            Navigation is disabled for exam mode. Use of Safe Exam Browser is required.
        </p>
        <div id="security-information">
            <ul>
                <li id="seb-ck"></li>
                <li id="seb-bek"></li>
                <li id="seb-ua"></li>
                <li id="seb-version"></li>
            </ul>
        </div>
    </div>
    
    <div id="container1" class="iframe-container" style="left: 50px; top: 50px; width: 645px; height: 1000px;">
        <div class="iframe-header">Graphing</div>
        <iframe src="https://www.desmos.com/testing/cb-sat-ap/graphing" sandbox="allow-scripts allow-forms"></iframe>
        <div class="iframe-overlay"></div>
        <div class="resize-handle corner nw"></div>
        <div class="resize-handle corner ne"></div>
        <div class="resize-handle corner sw"></div>
        <div class="resize-handle corner se"></div>
        <div class="resize-handle edge n"></div>
        <div class="resize-handle edge s"></div>
        <div class="resize-handle edge e"></div>
        <div class="resize-handle edge w"></div>
    </div>

    <div id="container2" class="iframe-container" style="left: 700px; top: 50px; width: 645px; height: 688px;">
        <div class="iframe-header">Matrix</div>
        <iframe src="https://www.desmos.com/matrix" sandbox="allow-scripts allow-forms"></iframe>
        <div class="nav-blocker-top"></div>
        <div class="nav-blocker-bottom"></div>
        <div class="iframe-overlay"></div>
        <div class="resize-handle corner nw"></div>
        <div class="resize-handle corner ne"></div>
        <div class="resize-handle corner sw"></div>
        <div class="resize-handle corner se"></div>
        <div class="resize-handle edge n"></div>
        <div class="resize-handle edge s"></div>
        <div class="resize-handle edge e"></div>
        <div class="resize-handle edge w"></div>
    </div>
    <footer>
        <div class="footer-content">
            Â© Caleb Li 2025. No Rights Reserved. Not affiliated with Desmos.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>
        let activeContainer = null;
        let isDragging = false;
        let isResizing = false;
        let resizeDirection = null;
        let startX, startY, startLeft, startTop, startWidth, startHeight;
        let zIndexCounter = 1000; // Track z-index for stacking order
        
        // Store original dimensions for maximize/restore
        const savedDimensions = new Map();

        const containers = document.querySelectorAll('.iframe-container');



        containers.forEach(container => {
            const header = container.querySelector('.iframe-header');
            const resizeHandles = container.querySelectorAll('.resize-handle');
            const overlay = container.querySelector('.iframe-overlay');

            // Make container active on click
            container.addEventListener('mousedown', (e) => {
                // Remove active class from previous container
                if (activeContainer && activeContainer !== container) {
                    activeContainer.classList.remove('active');
                }
                
                // Add active class to clicked container
                container.classList.add('active');
                activeContainer = container;
                
                // Bring clicked container to front
                zIndexCounter++;
                container.style.zIndex = zIndexCounter;
            });

            // Double-click to maximize/restore
            header.addEventListener('dblclick', (e) => {
                const containerId = container.id;
                
                if (savedDimensions.has(containerId)) {
                    // Restore to saved dimensions
                    const saved = savedDimensions.get(containerId);
                    container.style.left = saved.left;
                    container.style.top = saved.top;
                    container.style.width = saved.width;
                    container.style.height = saved.height;
                    savedDimensions.delete(containerId);
                } else {
                    // Save current dimensions
                    savedDimensions.set(containerId, {
                        left: container.style.left,
                        top: container.style.top,
                        width: container.style.width,
                        height: container.style.height
                    });
                    
                    // Maximize to full screen
                    container.style.left = '0px';
                    container.style.top = '0px';
                    container.style.width = window.innerWidth + 'px';
                    container.style.height = window.innerHeight + 'px';
                }
                
                // Update bottom blocker visibility
                updateBottomBlocker(container);
                e.preventDefault();
            });

            // Dragging functionality
            header.addEventListener('mousedown', (e) => {
                if (e.target === header) {
                    isDragging = true;
                    overlay.classList.add('active');
                    startX = e.clientX;
                    startY = e.clientY;
                    startLeft = container.offsetLeft;
                    startTop = container.offsetTop;
                    e.preventDefault();
                }
            });

            // Resizing functionality
            resizeHandles.forEach(handle => {
                handle.addEventListener('mousedown', (e) => {
                    isResizing = true;
                    overlay.classList.add('active');
                    resizeDirection = handle.className.split(' ').filter(c => c !== 'resize-handle' && c !== 'corner' && c !== 'edge')[0];
                    startX = e.clientX;
                    startY = e.clientY;
                    startLeft = container.offsetLeft;
                    startTop = container.offsetTop;
                    startWidth = container.offsetWidth;
                    startHeight = container.offsetHeight;
                    e.preventDefault();
                    e.stopPropagation();
                });
            });
        });

        // Global mouse move handler
        document.addEventListener('mousemove', (e) => {
            if (isDragging && activeContainer) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                activeContainer.style.left = (startLeft + dx) + 'px';
                activeContainer.style.top = (startTop + dy) + 'px';
            } else if (isResizing && activeContainer) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;

                let newLeft = startLeft;
                let newTop = startTop;
                let newWidth = startWidth;
                let newHeight = startHeight;

                // Handle horizontal resizing
                if (resizeDirection.includes('e')) {
                    newWidth = Math.max(645, startWidth + dx);
                } else if (resizeDirection.includes('w')) {
                    newWidth = Math.max(645, startWidth - dx);
                    newLeft = startLeft + (startWidth - newWidth);
                }

                // Handle vertical resizing
                if (resizeDirection.includes('s')) {
                    newHeight = Math.max(688, startHeight + dy);
                } else if (resizeDirection.includes('n')) {
                    newHeight = Math.max(688, startHeight - dy);
                    newTop = startTop + (startHeight - newHeight);
                }

                activeContainer.style.left = newLeft + 'px';
                activeContainer.style.top = newTop + 'px';
                activeContainer.style.width = newWidth + 'px';
                activeContainer.style.height = newHeight + 'px';
            }
        });

        // Global mouse up handler
        document.addEventListener('mouseup', () => {
            if (isDragging || isResizing) {
                isDragging = false;
                isResizing = false;
                resizeDirection = null;
                
                // Remove overlay from all containers
                document.querySelectorAll('.iframe-overlay').forEach(overlay => {
                    overlay.classList.remove('active');
                });
            }
        });

        // Prevent text selection while dragging
        document.addEventListener('selectstart', (e) => {
            if (isDragging || isResizing) {
                e.preventDefault();
            }
        });

        // Reset view function
        function resetView() {
            const container1 = document.getElementById('container1');
            const container2 = document.getElementById('container2');
            
            // Reset container 1
            container1.style.left = '50px';
            container1.style.top = '50px';
            container1.style.width = '645px';
            container1.style.height = '1000px';
            
            // Reset container 2
            container2.style.left = '700px';
            container2.style.top = '50px';
            container2.style.width = '645px';
            container2.style.height = '688px';
        
        }

        // Monitor header visibility to control flashing border
        function updateDangerBorder() {
            const headerContent = document.getElementById('header-content');
            const body = document.body;
            
            if (headerContent.classList.contains('d-block')) {
                body.classList.add('danger-active');
            } else {
                body.classList.remove('danger-active');
            }
        }

        // Initial check
        updateDangerBorder();
        
        // Watch for changes to header visibility
        const headerContent = document.getElementById('header-content');
        const observer = new MutationObserver(updateDangerBorder);
        observer.observe(headerContent, { attributes: true, attributeFilter: ['class'] });
    </script>
</body>
</html>